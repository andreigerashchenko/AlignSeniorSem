<MainScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: 12
        spacing: 10
        font:'font/sf-ui-display.otf'
        canvas.before:
            Color:
                rgba: 132/255,39/255,39/255,1
            Rectangle:
                pos: self.pos
                size: self.size

        BoxLayout: 
            orientation: "horizontal"
            padding: 8
            spacing: 4
            
            Button:
                pos_hint: {'center_x ': 0.3, 'top': 1}
                background_normal: 'images/help button.png'
                background_down: 'images/help buttonDown.png'
                size_hint: None, None
                size: 50, 50    
                on_press: root.open_Help()


            AsyncImage:
                id: previewImage
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                size_hint: 1,1
                source: ".previewImg.jpg"
                id: previewImage
                radius: [8,]
                keep_ratio: True

            
                
        BoxLayout: 
            orientation: "horizontal"
            align: 'center'
            size_hint: 1, 0.205
            pos_hint: {'center_x': 0.5,'center_y': 1}
            padding: 10
            spacing: 14


            
            
            
            Label:
                pos_hint: {'center_y': 0.5}
                font_size: 45
                font:'font/sf-ui-display.otf'
                text: "  Job Queue:"
                size_hint: 0.35,0.5

            ScrollView:
                #id: imgQueue
                height: 50
                do_scroll_y: False
                
                BoxLayout:
                    id: imgQueue
                    size_hint_x: None
                    width: self.minimum_width
                    orientation: 'horizontal'
                    padding: 10, 0
                    spacing: 10

            
            Button:
                text: "Undo"
                id: undoButton
                background_color: 2.85,2.850,2.850,1
                color: 0,0,0,1
                size_hint: 0.24,1
                font_size: 32
                pos_hint: {'center_x':0 ,'center_y': 0.5}
                id: undoButton
                on_press: 
                    root.undo()
                    self.background_color = (0,0,0,1)
                    self.color = (2.85,2.850,2.850,1)
                on_release: 
                    self.background_color = (2.85,2.850,2.850,1)
                    self.color= 0,0,0,1




        BoxLayout:
            orientation: "horizontal"
            size_hint: 0.75, 0.75
            padding: 15
            spacing: 18
            pos_hint: {'center_x': 0.5,'center_y': 1}

            GridLayout:
                cols: 4
                rows: 4
                padding: 10
                spacing: 15

                Label:
                    text: "Flip Vertical"

                Switch:
                    border_radius: 10
                    #size_hint: 0.2,0.425
                    id: mirrorY_switch
                    active: False
                    #font_size: dp(16)
                    on_active: root.flipVertical()


                Label:
                    text: "Flip Horizontal"
                Switch:
                    text: "Flip Horizontal"
                    #size_hint: 0.32,0.425
                    id: mirrorX_switch
                    active: False
                    disabled: False
                    #font_size: dp(16)
                    on_active: root.flipHorizontal()
                Label: 
                    text: "Timelapse: "
                Switch:
                    background_color: 1,0.5,1,0.9
                    #size_hint: 0.32,0.425
                    id: my_switch
                    active: True
                    disabled: False
                    font_size: 32
                Label: 
                    text: "VR Support: "
                Switch:
                    background_color: 1,0.5,0,0.9
                    #size_hint: 0.32,0.45
                    id: my_switch
                    active: True
                    disabled: False
                    font_size: 32

                Label: 
                    text: "Manual Horizon: "
                Switch:
                    background_color: 1,0.5,0,0.9
                    #size_hint: 0.32,0.45
                    id: manual_switch
                    active: True
                    disabled: False
                    font_size: 32

                


            GridLayout:
                cols: 1
                rows: 4
                padding: 10
                spacing: 10
                size_hint: 0.75,1

                Button:
                    background_color: 2.85,2.850,2.850,1
                    color: 0,0,0,1
                    on_press: 
                        #root.ids.previewImage.source = "imgassets/r4.jpg"
                        root.openFileBrowser()
                        self.background_color = (0,0,0,1)
                        self.color = (2.85,2.850,2.850,1)
                    size_hint: 0.1,0.2
                    id: increment
                    text: "Add Files"
                    on_release: 
                        self.background_color= (2.85,2.850,2.850,1)
                        self.color= 0,0,0,1

                Button:
                    color: 0,0,0,1
                    background_color: 2.85,2.850,2.850,1
                    on_press: 
                        self.background_color = (0,0,0,1)
                        self.color = (2.85,2.850,2.850,1)
                    size_hint: 0.05,0.2
                    id: increment
                    text: "Process"
                    on_press:
                    on_release: 
                        self.background_color = (2.85,2.850,2.850,1)
                        self.color= 0,0,0,1
                        root.processImage()


                Button:

                    color: 0,0,0,1
                    background_color: 2.85,2.850,2.850,1
                    on_press: 
                        self.background_color = (0,0,0,1)
                        self.color = (2.85,2.850,2.850,1)
                    size_hint: 0.05,0.2
                    id: saveButton
                    text: "Save"
                    on_press: root.saveImagePopup()
                    on_release: 
                        self.background_color = (2.85,2.850,2.850,1)
                        self.color= 0,0,0,1

                Button:
                    background_color: 2.85,2.850,2.850,1
                    color: 0,0,0,1
                    on_release: 
                        self.background_color = (2.85,2.850,2.850,1)
                        self.color= 0,0,0,1
                    on_press: 
                        self.background_color = (0,0,0,1)
                        self.color = (2.85,2.850,2.850,1)
                    size_hint: 0.025,0.2
                    id: increment
                    text: "Preferences"
                    on_press: root.open_popup()




<DownloadPopup>
    id: downloadPopup
    size_hint: 0.8,.1
    auto_dismiss: True
    title: 'Download: '
    padding: 40
    space: 40
    background_color: 152/255,49/255,49/255,1

    BoxLayout:
        orientation: "horizontal"
        Label:
            id: saveFileNameLabel
            text: "Enter a file name: "
            size_hint_x:.2
        TextInput:
            id: saveFileNameInput
            size_hint_x: .6
            font_size: 16
            multiline: False
            #on_text_validate = app.root.saveImage()
        Button:
            text: "Enter"
            size_hint_x: .2
            on_press: app.root.saveImage()




<PrefPopup>:
    id: pref
    size_hint: 0.75, 0.75
    auto_dismiss: False
    title: 'Preferences: '
    background_color: 152/255,171/255,171/255,1
    

    BoxLayout:
        orientation: 'vertical'
        padding: 12

        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1,1
            padding: 8
            spacing: 8

            GridLayout:
                cols: 2
                rows: 2
                padding: 10
                spacing: -1
                size_hint: 0.25,1
                
                Label:
                    text: "General: "
                    pos_hint: {'x': 0,'center_y': 1}
                Label:
                    text: ""
                Label:
                    text: "Scale Factor: "
                    pos_hint: {'x': 0,'center_y': 1}
                MDSlider:
                    id: scaleFactSlider
                    min: 0
                    max: 10
                    value: 5
                    pos_hint: {'x': 0,'center_y': 1}

            GridLayout:
                cols: 2
                rows: 7
                padding: 10
                spacing: 10
                size_hint: 0.25,1
                
                Label:
                    text: "Auto Horizon: "
                    pos_hint: {'x': 0,'center_y': 1}
                Label:
                    text: ""
                Label:
                    text: "Min Height "
                    pos_hint: {'x': 0,'center_y': 1}
                MDSlider:
                    id: minHeightSlider
                    min: 0
                    max: 10
                    value: 5
                    pos_hint: {'x': 0,'center_y': 1}
                Label:
                    text: "Max Height "
                    pos_hint: {'x': 0,'center_y': 1}
                MDSlider:
                    id: maxHeightSlider
                    min: 0
                    max: 10
                    value: 5
                    pos_hint: {'x': 0,'center_y': 1}

                Label:
                    text: "Length weight "
                    pos_hint: {'x': 0,'center_y': 1}
                MDSlider:
                    id: lengthWeightSlider
                    min: 0
                    max: 10
                    value: 5
                    pos_hint: {'x': 0,'center_y': 1}
                Label:
                    text: "Smoothness weight"
                    pos_hint: {'x': 0,'center_y': 1}
                MDSlider:
                    id: smoothWeightSlider
                    min: 0
                    max: 10
                    value: 0
                    pos_hint: {'x': 0,'center_y': 1}
                Label:
                    text: "Linearity Weight "
                    pos_hint: {'x': 0,'center_y': 1}
                MDSlider:
                    id: linearityWeightSlider
                    min: 0
                    max: 100
                    value: 0
                    pos_hint: {'x': 0,'center_y': 1}
                Label:
                    text: "Debug mode "
                    pos_hint: {'x': 0,'center_y': 1}
                MDSwitch:
                    id: debugAutoSwitch
                    #active: True
                    pos_hint: {'x': 0,'center_y': 1}
                    #size_hint: 0.2, 1
                    
                    #on_active: app.root.toggle_debug_mode()



        BoxLayout:
            orientation: 'horizontal'
            padding: 8
            spacing: 8
            size_hint: 1,1

            GridLayout:
                cols: 2
                rows: 3
                padding: 10
                spacing: 10
                size_hint: 0.25,1
                

                Label:
                    text: "Output: "
                Label:
                    text: ""
                Label:
                    text: "Default Directory "
                Label:
                    text: "add file browser image here "

                Label:
                    text: "Default output suffix "
                TextInput:
                    id: outputsuffix
                    hint_text: '10'
                    size_hint: (None, None)
                    height: 50
                    width: 45
                    pos_hint: {'center_x': 1,'center_y': 1}
                    multiline: False

            GridLayout:
                cols: 2
                rows: 3
                padding: 10
                spacing: 10
                size_hint: 0.25,1
                

                Label:
                    text: "Video: "
                Label:
                    text: ""
                Label:
                    text: "FPS: "
                MDSlider:
                    id: fpsSlider
                    min: 0
                    max: 100
                    value: 0
                    pos_hint: {'x': 0,'center_y': 1}
                Label:
                    text: "horizon recalculation\nframe interval "
                TextInput:
                    id: hrfi
                    hint_text: '10'
                    size_hint: (None, None)
                    height: 50
                    width: 45
                    pos_hint: {'center_x': 1,'center_y': 1}
                    multiline: False

 
        Button:
            text: 'Close'
            size_hint: 0.2, 0.2
            pos_hint: {'center_x': 0.5, 'center_y': 1}
            on_press: 
                root.save_preferences()
                root.dismiss()





<HelpPopup>:
    id: help
    size_hint: 0.8, 0.8
    auto_dismiss: False
    title: ''
    padding: 40
    space: 40
    background_color: 152/255,49/255,49/255,1
    BoxLayout:
        orientation: 'vertical'
    
        Label:
            size_hint_y: 0.65
            text_size: self.width, None
            text: 'Usage:\n\n 1. Click on the Add Files button to select images or videos to add to the queue.\n\n2. Select whether the images need to be flipped horizontally or vertically.\n\n3. Select whether you would like to use the automatic horizon detection feature. Automatic horizon detection is always enabled for videos.\n\n4. If Manual Horizon is enabled, click on the lowest point of the horizon, and then click process.'
        Button:
            text: 'Close'
            size_hint: 0.2, 0.2
            pos_hint: {'center_x': 0.5, 'center_y': 1}
            on_press: root.dismiss()

        Label:
            text: ''


<VidPreviewPopup>:
    title: "Save Video"
    auto_dismiss: False
    size_hint: 0.9, 0.9
    BoxLayout:
        orientation: "vertical"
        padding: 12
        spacing: 10

        BoxLayout:
            orientation: "horizontal"
            size_hint: 1,None
            height: 30

            Label:
                id: saveFileNameLabel
                text: "Name: "
                size_hint_x: None
                width: 50
            TextInput:
                id: saveFileNameInput
                size_hint_x: .8
                font_size: 16
                multiline: False
                #on_text_validate = root.saveImage()
            Button:
                text: "Browse"
                size_hint_x: None
                width: 65
                on_press: root.browseFile()


        VideoPlayer:
            id: vidPreview
            allow_stretch:True
            size_hint_y: .8
            source:".vidPreview.mp4"
            #options: {'eos': 'loop'}

        BoxLayout:
            size_hint: 1,.1
            pos_hint: {'center_x': 0.5, 'center_y': 1}

            Button:
                size_hint: .8,1
                color: 0,0,0,1
                background_color: 2.85,2.850,2.850,1
                on_press:
                    self.background_color = (0,0,0,1)
                    self.color = (2.85,2.850,2.850,1)
                allow_stretch: True
                id: increment
                text: "Save"
                id: save_button
                on_press: root.saveVideo()
                on_release:
                    self.background_color = (2.85,2.850,2.850,1)
                    self.color= 0,0,0,1
            Button:
                text: 'Cancel'
                size_hint: 0.2, 1
                on_press: root.dismiss()



